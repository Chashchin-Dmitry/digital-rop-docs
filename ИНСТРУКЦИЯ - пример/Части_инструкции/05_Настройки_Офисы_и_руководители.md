# 5. Настройки - Офисы и руководители

Раздел для управления структурой офисов и назначения руководителей в системе.

## Общий вид

**Офисы и руководители. Общий вид.png** - Список офисов и назначенных руководителей

{INTERFACE} Таблица содержит колонки: номер офиса (#), название офиса/подразделения и назначенные руководители. Примеры: "ПСО → Елена Красильникова" (один руководитель), "Дилерские продажи → Наталья Сабаева, Елена Гуторова, Анна Сергеенкова" (несколько руководителей).

## Техническая интеграция с CRM

{TECHNICAL} Данные об офисах синхронизируются автоматически из CRM Setl Group через API. Система использует integer ID офисов для внутренней идентификации, а руководители и менеджеры связываются через UUID из корпоративной системы.

### API синхронизация офисов:
**Endpoint**: `POST http://10.28.32.81/api/v1/settings/offices-update?apiKey=LS6gz1bkpG3lZI6uXetEoLtoVtVXYuWO`

**Структура запроса**:
```json
{
  "offices": [
    {
      "office_title": "Название офиса",
      "office_id": "integer_id",
      "leader_ids": ["uuid1", "uuid2", "uuid3"],
      "managers_ids": ["uuid1", "uuid2", "uuid3", "uuid4"]
    }
  ]
}
```

### Идентификаторы:
- **office_id**: целочисленный идентификатор офиса (как в колонке "#")
- **leader_ids**: массив UUID руководителей офиса
- **managers_ids**: массив UUID менеджеров, работающих в офисе

## Принцип работы

### Назначение руководителей:
- **Пустые ячейки**: офисы без назначенных руководителей
- **Одиночные назначения**: один руководитель на офис (например, "Елена Красильникова")
- **Множественные назначения**: несколько руководителей для одного офиса (через запятую)

### Обновление данных:
- Информация синхронизируется автоматически из CRM Setl Group
- Система использует integer ID офисов для внутренней идентификации
- Руководители и менеджеры связываются через UUID из корпоративной системы

## Связь с другими разделами

### Фильтрация в аналитических разделах:
- Офисы из этого списка используются в фильтрах "Поиск по офису"
- Руководители видят данные только по своим офисам (согласно LDAP-правам)
- ID офисов связываются с менеджерами через API интеграции

### LDAP интеграция:
- **Проблема привязки к офису**: в Active Directory нет четкой привязки к офису (есть только поле "адрес")
- **Решение через группы**: роли реализуются через создание групп в AD и добавление пользователей
- **Мобильность сотрудников**: учитывается, что сотрудники могут работать удаленно или перемещаться между офисами

## Управление доступом

### Уровни доступа:
- **Суперадминистратор**: видит все офисы, может назначать руководителей
- **Руководители офисов**: видят только данные своих подразделений
- **Менеджеры**: видят только свои данные

### Техническая реализация:
- Аутентификация через корпоративную LDAP систему Setl Group
- Права определяются на основе групп в Active Directory
- Автоматическое разграничение доступа к данным офисов

## Ключевые особенности:

1. **API-управляемая структура** - данные обновляются автоматически из CRM через API
2. **Integer ID офисов** - простые числовые идентификаторы для быстрой работы системы
3. **UUID идентификация пользователей** - связь с корпоративной системой через уникальные идентификаторы
4. **Гибкое руководство** - поддержка множественных руководителей для одного офиса
5. **LDAP интеграция** - аутентификация через корпоративную Active Directory
6. **Автоматическая синхронизация** - регулярное обновление структуры из внешних систем